<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eventos y Capacitaci칩n - Sistema de Supervisi칩n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="js/api.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .event-card {
            transition: all 0.3s ease;
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-day:hover {
            background-color: #f3f4f6;
        }

        .calendar-day.has-event {
            position: relative;
        }

        .calendar-day.has-event::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #667eea;
        }

        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
    </style>
    <script>
        function eventosData() {
            return {
    sidebarOpen: true,
    showEventModal: false,
    showParticipantsModal: false,
    showAddParticipantModal: false,
    viewMode: 'grid',
    filterStatus: 'all',
    searchQuery: '',
    selectedEvent: null,
    selectedEventForParticipants: null,
    events: [],
    participants: [],
    availableUsers: [],
    searchUserQuery: '',
    loading: true,
    toasts: [],
    userProfile: null,
    showProfileMenu: false,
    calendarMonth: new Date().getMonth(),
    calendarYear: new Date().getFullYear(),
    eventStats: {
        total_events: 0,
        programado: 0,
        en_curso: 0,
        completado: 0,
        total_participants: 0
    },
    formData: {
        title: '',
        description: '',
        type: 'capacitacion',
        start_date: '',
        end_date: '',
        start_time: '',
        end_time: '',
        location: '',
        instructor_id: null,
        max_participants: 50,
        is_online: false,
        meeting_url: ''
    },
    saving: false,
    
    // Helper: Detectar tipo de plataforma de reuni칩n (mismo que supervision-tiempo-real.html)
    getMeetingPlatform(meetingUrl) {
        if (!meetingUrl) return null;
        const url = meetingUrl.toLowerCase();
        if (url.includes('jitsi') || url.includes('meet.jit.si') || url.includes('8x8.vc')) {
            return 'jitsi';
        } else if (url.includes('meet.google.com') || url.includes('google.com/meet')) {
            return 'google-meet';
        } else if (url.includes('zoom.us') || url.includes('zoom.com')) {
            return 'zoom';
        } else if (url.includes('teams.microsoft.com') || url.includes('teams.live.com')) {
            return 'teams';
        } else if (url.includes('webex.com')) {
            return 'webex';
        } else if (url.includes('gotomeeting.com')) {
            return 'gotomeeting';
        }
        return 'generic';
    },
    
    // Helper: Obtener nombre de la plataforma
    getPlatformName(meetingUrl) {
        if (!meetingUrl) return null;
        const platform = this.getMeetingPlatform(meetingUrl);
        const names = {
            'jitsi': 'Jitsi Meet',
            'google-meet': 'Google Meet',
            'zoom': 'Zoom',
            'teams': 'Microsoft Teams',
            'webex': 'Webex',
            'gotomeeting': 'GoToMeeting',
            'generic': 'Reuni칩n en l칤nea'
        };
        return names[platform] || 'Reuni칩n en l칤nea';
    },
    
    // Helper: Abrir enlace de reuni칩n
    openMeetingUrl(event) {
        if (event.meeting_url) {
            window.open(event.meeting_url, '_blank');
        }
    },
    
    async init() {
        if (!api.getToken()) {
            window.location.href = '/login.html';
            return;
        }
        
        await this.loadData();
        
        // Verificar si hay hash para mostrar evento espec칤fico
        const hash = window.location.hash;
        if (hash && hash.startsWith('#event-')) {
            const eventId = parseInt(hash.replace('#event-', ''));
            const event = this.events.find(e => e.id === eventId);
            if (event) {
                this.openEventModal(event);
            }
        }
    },
    
    async loadData() {
        try {
            this.loading = true;
            
            // Cargar perfil
            const profileRes = await api.getProfile();
            if (profileRes.success) {
                this.userProfile = profileRes.data;
            }
            
            // Cargar estad칤sticas de eventos
            const statsRes = await api.getEventsStats();
            if (statsRes.success && statsRes.data) {
                this.eventStats = {
                    total_events: parseInt(statsRes.data.total_events || 0),
                    programado: parseInt(statsRes.data.programado || 0),
                    en_curso: parseInt(statsRes.data.en_curso || 0),
                    completado: parseInt(statsRes.data.completado || 0),
                    total_participants: parseInt(statsRes.data.total_participants || 0)
                };
            }
            
            // Cargar todos los eventos
            const eventsRes = await api.getEvents();
            if (eventsRes.success) {
                this.events = (eventsRes.data || []).map(event => ({
                    ...event,
                    color: this.getColorForType(event.type),
                    status: this.mapStatus(event.status),
                    current_participants: parseInt(event.current_participants || 0),
                    max_participants: parseInt(event.max_participants || 0)
                }));
            }
        } catch (error) {
            console.error('Error loading data:', error);
            if (error.message.includes('401')) {
                window.location.href = '/login.html';
            }
        } finally {
            this.loading = false;
        }
    },
    
    get filteredEvents() {
        let filtered = this.events;

        if (this.filterStatus !== 'all') {
            const statusMap = {
                'Programado': 'programado',
                'En curso': 'en_curso',
                'Completado': 'completado'
            };
            const backendStatus = statusMap[this.filterStatus] || this.filterStatus;
            filtered = filtered.filter(e => {
                const eventStatus = e.status === 'programado' || e.status === 'en_curso' || e.status === 'completado' 
                    ? e.status 
                    : this.mapStatus(e.status);
                return eventStatus === backendStatus || eventStatus === this.filterStatus;
            });
        }

        if (this.searchQuery) {
            filtered = filtered.filter(e =>
                e.title?.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                e.description?.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                e.type?.toLowerCase().includes(this.searchQuery.toLowerCase())
            );
        }

        return filtered;
    },
    
    mapStatus(status) {
        const statusMap = {
            'programado': 'Programado',
            'en_curso': 'En curso',
            'completado': 'Completado',
            'cancelado': 'Cancelado'
        };
        return statusMap[status] || status;
    },
    
    getColorForType(type) {
        const colors = {
            'capacitacion': 'blue',
            'workshop': 'purple',
            'seminario': 'green',
            'taller': 'orange',
            'conferencia': 'indigo',
            'webinar': 'pink'
        };
        return colors[type] || 'blue';
    },
    
    // Funciones para el calendario
    getCalendarDays() {
        const firstDay = new Date(this.calendarYear, this.calendarMonth, 1);
        const lastDay = new Date(this.calendarYear, this.calendarMonth + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay(); // 0 = Domingo, 1 = Lunes, etc.
        
        const days = [];
        
        // Agregar d칤as vac칤os al inicio para alinear el primer d칤a del mes
        for (let i = 0; i < startingDayOfWeek; i++) {
            days.push({ day: null, date: null });
        }
        
        // Agregar todos los d칤as del mes
        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(this.calendarYear, this.calendarMonth, day);
            days.push({ day: day, date: date });
        }
        
        return days;
    },
    
    hasEventOnDate(date) {
        if (!date) return false;
        return this.events.some(event => {
            if (!event.start_date) return false;
            const eventDate = new Date(event.start_date);
            return eventDate.getDate() === date.getDate() &&
                   eventDate.getMonth() === date.getMonth() &&
                   eventDate.getFullYear() === date.getFullYear();
        });
    },
    
    getCalendarMonthName() {
        const date = new Date(this.calendarYear, this.calendarMonth);
        return date.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
    },
    
    previousMonth() {
        if (this.calendarMonth === 0) {
            this.calendarMonth = 11;
            this.calendarYear--;
        } else {
            this.calendarMonth--;
        }
    },
    
    nextMonth() {
        if (this.calendarMonth === 11) {
            this.calendarMonth = 0;
            this.calendarYear++;
        } else {
            this.calendarMonth++;
        }
    },
    
    goToToday() {
        const today = new Date();
        this.calendarMonth = today.getMonth();
        this.calendarYear = today.getFullYear();
    },
    
    isToday(date) {
        if (!date) return false;
        const today = new Date();
        return date.getDate() === today.getDate() &&
               date.getMonth() === today.getMonth() &&
               date.getFullYear() === today.getFullYear();
    },
    
    selectDay(date) {
        if (!date) return;
        // Buscar eventos en ese d칤a
        const eventsOnDay = this.events.filter(event => {
            if (!event.start_date) return false;
            const eventDate = new Date(event.start_date);
            return eventDate.getDate() === date.getDate() &&
                   eventDate.getMonth() === date.getMonth() &&
                   eventDate.getFullYear() === date.getFullYear();
        });
        
        if (eventsOnDay.length > 0) {
            // Si hay eventos, abrir el primero
            this.openEventModal(eventsOnDay[0]);
        }
    },
    
    openEventModal(event = null) {
        this.selectedEvent = event;
        if (event) {
            this.formData = {
                title: event.title || '',
                description: event.description || '',
                type: event.type || 'capacitacion',
                start_date: event.start_date || '',
                end_date: event.end_date || '',
                start_time: event.start_time || '',
                end_time: event.end_time || '',
                location: event.location || '',
                instructor_id: event.instructor_id || null,
                max_participants: event.max_participants || 50,
                is_online: event.is_online || false,
                meeting_url: event.meeting_url || ''
            };
        } else {
            this.formData = {
                title: '',
                description: '',
                type: 'capacitacion',
                start_date: '',
                end_date: '',
                start_time: '',
                end_time: '',
                location: '',
                instructor_id: null,
                max_participants: 50,
                is_online: false,
                meeting_url: ''
            };
        }
        this.showEventModal = true;
    },
    
    async saveEvent() {
        try {
            this.saving = true;
            
            // Validar campos requeridos
            if (!this.formData.title || !this.formData.title.trim()) {
                this.showToast('El t칤tulo es requerido', 'warning');
                return;
            }
            
            if (!this.formData.start_date) {
                this.showToast('La fecha de inicio es requerida', 'warning');
                return;
            }
            
            if (!this.formData.location || !this.formData.location.trim()) {
                this.showToast('La ubicaci칩n es requerida', 'warning');
                return;
            }
            
            // Preparar datos con formato correcto
            const eventData = {
                title: this.formData.title.trim(),
                description: this.formData.description || '',
                type: this.formData.type || 'capacitacion',
                status: this.formData.status || 'programado',
                location: this.formData.location.trim(),
                max_participants: parseInt(this.formData.max_participants) || 50,
                is_online: this.formData.is_online || false
            };
            
            // Validar y formatear meeting_url solo si est치 presente y no est치 vac칤o
            if (this.formData.meeting_url && this.formData.meeting_url.trim()) {
                const url = this.formData.meeting_url.trim();
                // Validar que sea una URL v치lida
                try {
                    new URL(url); // Esto lanzar치 error si no es una URL v치lida
                    eventData.meeting_url = url;
                } catch (error) {
                    // Si no es una URL v치lida, intentar agregar https://
                    if (!url.startsWith('http://') && !url.startsWith('https://')) {
                        const urlWithProtocol = 'https://' + url;
                        try {
                            new URL(urlWithProtocol);
                            eventData.meeting_url = urlWithProtocol;
                        } catch (e) {
                            this.showToast('La URL de la reuni칩n no es v치lida. Debe ser una URL completa (ej: https://meet.google.com/xxx)', 'warning');
                            return;
                        }
                    } else {
                        this.showToast('La URL de la reuni칩n no es v치lida', 'warning');
                        return;
                    }
                }
            }
            // Si meeting_url est치 vac칤o, no lo incluimos en eventData (el backend lo manejar치 como opcional)
            
            // Formatear fecha a ISO8601 (YYYY-MM-DD)
            if (this.formData.start_date) {
                const startDate = new Date(this.formData.start_date);
                if (!isNaN(startDate.getTime())) {
                    eventData.start_date = startDate.toISOString().split('T')[0]; // YYYY-MM-DD
                } else {
                    // Si ya est치 en formato YYYY-MM-DD, usarlo directamente
                    eventData.start_date = this.formData.start_date;
                }
            }
            
            if (this.formData.end_date) {
                const endDate = new Date(this.formData.end_date);
                if (!isNaN(endDate.getTime())) {
                    eventData.end_date = endDate.toISOString().split('T')[0]; // YYYY-MM-DD
                } else {
                    eventData.end_date = this.formData.end_date;
                }
            }
            
            // Formatear tiempo a HH:MM:SS
            if (this.formData.start_time) {
                // Si viene en formato HH:MM, agregar :00
                if (this.formData.start_time.match(/^\d{2}:\d{2}$/)) {
                    eventData.start_time = this.formData.start_time + ':00';
                } else if (this.formData.start_time.match(/^\d{2}:\d{2}:\d{2}$/)) {
                    eventData.start_time = this.formData.start_time;
                } else {
                    // Intentar convertir formato de hora
                    const timeMatch = this.formData.start_time.match(/(\d{1,2}):(\d{2})/);
                    if (timeMatch) {
                        const hours = timeMatch[1].padStart(2, '0');
                        const minutes = timeMatch[2];
                        eventData.start_time = `${hours}:${minutes}:00`;
                    } else {
                        eventData.start_time = '09:00:00'; // Valor por defecto
                    }
                }
            } else {
                eventData.start_time = '09:00:00'; // Valor por defecto si no se proporciona
            }
            
            if (this.formData.end_time) {
                // Si viene en formato HH:MM, agregar :00
                if (this.formData.end_time.match(/^\d{2}:\d{2}$/)) {
                    eventData.end_time = this.formData.end_time + ':00';
                } else if (this.formData.end_time.match(/^\d{2}:\d{2}:\d{2}$/)) {
                    eventData.end_time = this.formData.end_time;
                } else {
                    // Intentar convertir formato de hora
                    const timeMatch = this.formData.end_time.match(/(\d{1,2}):(\d{2})/);
                    if (timeMatch) {
                        const hours = timeMatch[1].padStart(2, '0');
                        const minutes = timeMatch[2];
                        eventData.end_time = `${hours}:${minutes}:00`;
                    } else {
                        eventData.end_time = '17:00:00'; // Valor por defecto
                    }
                }
            } else {
                eventData.end_time = '17:00:00'; // Valor por defecto si no se proporciona
            }
            
            // Instructor ID si est치 presente
            if (this.formData.instructor_id) {
                eventData.instructor_id = parseInt(this.formData.instructor_id);
            }
            
            let response;
            if (this.selectedEvent) {
                // Actualizar evento existente
                response = await api.updateEvent(this.selectedEvent.id, eventData);
            } else {
                // Crear nuevo evento
                response = await api.createEvent(eventData);
            }
            
            if (response.success) {
                this.showToast('Evento guardado exitosamente', 'success');
                this.showEventModal = false;
                await this.loadData();
            } else {
                // Mostrar errores de validaci칩n del backend
                if (response.errors && Array.isArray(response.errors)) {
                    const errorMessages = response.errors.map(err => `${err.field}: ${err.message}`).join(', ');
                    throw new Error(errorMessages);
                }
                throw new Error(response.message || 'Error al guardar evento');
            }
        } catch (error) {
            console.error('Error saving event:', error);
            // Mostrar errores de validaci칩n detallados
            if (error.errors && Array.isArray(error.errors)) {
                const errorMessages = error.errors.map(err => {
                    // Traducir nombres de campos al espa침ol
                    const fieldNames = {
                        'title': 'T칤tulo',
                        'start_date': 'Fecha de inicio',
                        'start_time': 'Hora de inicio',
                        'end_time': 'Hora de fin',
                        'location': 'Ubicaci칩n',
                        'type': 'Tipo de evento',
                        'meeting_url': 'URL de reuni칩n',
                        'max_participants': 'M치ximo de participantes'
                    };
                    const fieldName = fieldNames[err.field] || err.field;
                    return `${fieldName}: ${err.message}`;
                }).join('\n');
                this.showToast('Errores de validaci칩n:\n' + errorMessages, 'error', 10000);
            } else {
                // Si el mensaje de error contiene informaci칩n de validaci칩n, mostrarla
                const errorMsg = error.message || 'Error desconocido';
                this.showToast('Error al guardar evento: ' + errorMsg, 'error', 6000);
            }
        } finally {
            this.saving = false;
        }
    },
    
    async deleteEvent(eventId) {
        if (!confirm('쮼st치s seguro de que deseas eliminar este evento?')) {
            return;
        }
        
        try {
            const response = await api.deleteEvent(eventId);
            if (response.success) {
                this.showToast('Evento eliminado exitosamente', 'success');
                await this.loadData();
                this.showEventModal = false;
            } else {
                throw new Error(response.message || 'Error al eliminar evento');
            }
        } catch (error) {
            console.error('Error deleting event:', error);
            this.showToast('Error al eliminar evento: ' + error.message, 'error', 6000);
        }
    },
    
    formatDate(dateString) {
        if (!dateString) return 'Sin fecha';
        try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) {
                return 'Fecha inv치lida';
            }
            return date.toLocaleDateString('es-ES', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric'
            });
        } catch (error) {
            return 'Fecha inv치lida';
        }
    },
    
    formatTime(timeString) {
        if (!timeString) return '';
        return timeString.substring(0, 5); // HH:MM
    },

    // Exportar calendario en formato iCal
    async exportCalendar() {
        try {
            this.showToast('Preparando calendario para exportar...', 'info', 2000);

            // Crear contenido iCal
            let icalContent = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//SuperVision//Eventos//ES\nCALSCALE:GREGORIAN\n';

            this.events.forEach(event => {
                const startDate = new Date(event.start_date + 'T' + (event.start_time || '00:00'));
                const endDate = new Date(event.end_date + 'T' + (event.end_time || '23:59'));

                icalContent += 'BEGIN:VEVENT\n';
                icalContent += `UID:${event.id}@supervision.com\n`;
                icalContent += `DTSTAMP:${this.formatDateToICal(new Date())}\n`;
                icalContent += `DTSTART:${this.formatDateToICal(startDate)}\n`;
                icalContent += `DTEND:${this.formatDateToICal(endDate)}\n`;
                icalContent += `SUMMARY:${event.title}\n`;
                icalContent += `DESCRIPTION:${(event.description || '').replace(/\n/g, '\\n')}\n`;
                icalContent += `LOCATION:${event.location || ''}\n`;
                icalContent += `STATUS:${event.status === 'completado' ? 'CONFIRMED' : 'TENTATIVE'}\n`;
                icalContent += 'END:VEVENT\n';
            });

            icalContent += 'END:VCALENDAR';

            // Descargar archivo
            const blob = new Blob([icalContent], { type: 'text/calendar;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `eventos-supervision-${new Date().toISOString().split('T')[0]}.ics`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);

            this.showToast('Calendario exportado exitosamente', 'success');
        } catch (error) {
            console.error('Error exporting calendar:', error);
            this.showToast('Error al exportar calendario: ' + error.message, 'error');
        }
    },

    formatDateToICal(date) {
        // Formato: YYYYMMDDTHHMMSSZ
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        const seconds = String(date.getSeconds()).padStart(2, '0');
        return `${year}${month}${day}T${hours}${minutes}${seconds}Z`;
    },

    async viewParticipants(eventId = null) {
        try {
            this.showToast('Cargando participantes...', 'info', 2000);
            this.selectedEventForParticipants = eventId ? this.events.find(e => e.id === eventId) : null;

            if (eventId) {
                // Mostrar participantes de un evento espec칤fico
                const response = await api.getEventParticipants(eventId);
                if (response.success && response.data) {
                    this.participants = response.data.map(p => ({
                        id: p.user_id || p.id,
                        name: p.full_name || p.user_name || 'Usuario',
                        email: p.email || '',
                        attendance_status: p.attendance_status || 'registered'
                    }));
                } else {
                    this.participants = [];
                }
            } else {
                // Obtener todos los participantes de todos los eventos (vista general)
                const participantsMap = new Map();

                for (const event of this.events) {
                    try {
                        const response = await api.getEventParticipants(event.id);
                        if (response.success && response.data) {
                            response.data.forEach(participant => {
                                const key = participant.user_id || participant.id;
                                if (!participantsMap.has(key)) {
                                    participantsMap.set(key, {
                                        id: key,
                                        name: participant.full_name || participant.user_name || 'Usuario',
                                        email: participant.email || '',
                                        eventsCount: 0,
                                        events: []
                                    });
                                }
                                const p = participantsMap.get(key);
                                p.eventsCount++;
                                p.events.push(event.title);
                            });
                        }
                    } catch (error) {
                        console.error(`Error loading participants for event ${event.id}:`, error);
                    }
                }

                this.participants = Array.from(participantsMap.values());
            }

            this.showParticipantsModal = true;

            if (this.participants.length === 0) {
                this.showToast('No hay participantes registrados', 'info');
            }
        } catch (error) {
            console.error('Error loading participants:', error);
            this.showToast('Error al cargar participantes: ' + error.message, 'error');
        }
    },

    // Verificar si el usuario es due침o del evento
    isEventOwner(event) {
        if (!event || !this.userProfile) return false;
        return event.created_by === this.userProfile.id || event.instructor_id === this.userProfile.id;
    },

    async addParticipantToEvent(eventId, userId = null) {
        try {
            const targetUserId = userId || this.userProfile?.id;
            if (!targetUserId) {
                this.showToast('No se pudo obtener la informaci칩n del usuario', 'error');
                return;
            }

            const response = await api.addEventParticipant(eventId, targetUserId);
            if (response.success) {
                // Recargar estad칤sticas para actualizar el contador de participantes
                const statsRes = await api.getEventsStats();
                if (statsRes.success && statsRes.data) {
                    this.eventStats = {
                        total_events: parseInt(statsRes.data.total_events || 0),
                        programado: parseInt(statsRes.data.programado || 0),
                        en_curso: parseInt(statsRes.data.en_curso || 0),
                        completado: parseInt(statsRes.data.completado || 0),
                        total_participants: parseInt(statsRes.data.total_participants || 0)
                    };
                }
                
                // Recargar eventos para actualizar current_participants en las tarjetas
                const eventsRes = await api.getEvents();
                if (eventsRes.success) {
                    this.events = (eventsRes.data || []).map(event => ({
                        ...event,
                        color: this.getColorForType(event.type),
                        status: this.mapStatus(event.status),
                        current_participants: parseInt(event.current_participants || 0),
                        max_participants: parseInt(event.max_participants || 0)
                    }));
                }
                
                if (userId) {
                    this.showToast('Participante agregado exitosamente', 'success');
                    // Remover el usuario de la lista de disponibles
                    this.availableUsers = this.availableUsers.filter(u => u.id !== userId);
                } else {
                    this.showToast('Te has registrado exitosamente en el evento', 'success');
                }
                // Recargar participantes del evento
                await this.viewParticipants(eventId);
            } else {
                throw new Error(response.message || 'Error al agregar participante');
            }
        } catch (error) {
            console.error('Error adding participant:', error);
            if (error.message && error.message.includes('already registered')) {
                this.showToast('El usuario ya est치 registrado en este evento', 'warning');
                // Remover el usuario de la lista de disponibles si ya estaba registrado
                if (userId) {
                    this.availableUsers = this.availableUsers.filter(u => u.id !== userId);
                }
            } else {
                this.showToast('Error al agregar participante: ' + error.message, 'error');
            }
        }
    },

    async openAddParticipantModal(eventId) {
        try {
            this.selectedEventForParticipants = this.events.find(e => e.id === eventId);
            this.searchUserQuery = '';
            this.showToast('Cargando usuarios disponibles...', 'info', 2000);
            
            // Primero cargar los participantes actuales del evento
            const participantsResponse = await api.getEventParticipants(eventId);
            let currentParticipantIds = [];
            if (participantsResponse.success && participantsResponse.data) {
                currentParticipantIds = participantsResponse.data.map(p => p.user_id || p.id);
            }
            
            // Luego cargar todos los usuarios
            const response = await api.getUsers();
            if (response.success) {
                // Filtrar usuarios que ya son participantes
                this.availableUsers = (response.data || []).filter(user => 
                    !currentParticipantIds.includes(user.id)
                );
                this.showAddParticipantModal = true;
            } else {
                throw new Error(response.message || 'Error al cargar usuarios');
            }
        } catch (error) {
            console.error('Error loading users:', error);
            this.showToast('Error al cargar usuarios: ' + error.message, 'error');
        }
    },

    get filteredAvailableUsers() {
        if (!this.searchUserQuery) return this.availableUsers;
        const query = this.searchUserQuery.toLowerCase();
        return this.availableUsers.filter(user =>
            user.full_name?.toLowerCase().includes(query) ||
            user.email?.toLowerCase().includes(query)
        );
    },

    // Generar reporte de eventos
    async generateReport() {
        try {
            this.showToast('Generando reporte...', 'info', 2000);

            // Preparar estad칤sticas
            const stats = {
                total: this.events.length,
                programados: this.events.filter(e => e.status === 'programado' || e.status === 'Programado').length,
                enCurso: this.events.filter(e => e.status === 'en_curso' || e.status === 'En curso').length,
                completados: this.events.filter(e => e.status === 'completado' || e.status === 'Completado').length,
                cancelados: this.events.filter(e => e.status === 'cancelado' || e.status === 'Cancelado').length
            };

            const byType = {};
            this.events.forEach(e => {
                const type = e.type || 'otro';
                byType[type] = (byType[type] || 0) + 1;
            });

            // Crear contenido HTML del reporte
            const dateStr = new Date().toLocaleDateString('es-ES', { dateStyle: 'full' });
            const year = new Date().getFullYear();
            const typeRows = Object.entries(byType).map(([type, count]) => 
                '<tr><td>' + (type.charAt(0).toUpperCase() + type.slice(1)) + '</td><td>' + count + '</td></tr>'
            ).join('');
            const eventRows = this.events.map(event => 
                '<tr><td>' + (event.title || '') + '</td><td>' + (event.type || 'N/A') + '</td><td>' + 
                this.formatDate(event.start_date) + '</td><td>' + (event.location || 'N/A') + '</td><td>' + 
                this.mapStatus(event.status) + '</td></tr>'
            ).join('');
            
            let reportHTML = '<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Reporte de Eventos - SuperVision</title><style>body { font-family: Arial, sans-serif; padding: 40px; max-width: 900px; margin: 0 auto; } h1 { color: #667eea; border-bottom: 3px solid #667eea; padding-bottom: 10px; } h2 { color: #764ba2; margin-top: 30px; } .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; } .stat-card { background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea; } .stat-card h3 { margin: 0 0 10px 0; color: #495057; font-size: 14px; } .stat-card p { margin: 0; font-size: 32px; font-weight: bold; color: #667eea; } table { width: 100%; border-collapse: collapse; margin: 20px 0; } th, td { padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6; } th { background: #667eea; color: white; } tr:hover { background: #f8f9fa; } .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #dee2e6; text-align: center; color: #6c757d; }</style></head><body><h1>游늵 Reporte de Eventos y Capacitaci칩n</h1><p><strong>Fecha de generaci칩n:</strong> ' + dateStr + '</p><h2>Resumen Estad칤stico</h2><div class="stats"><div class="stat-card"><h3>Total de Eventos</h3><p>' + stats.total + '</p></div><div class="stat-card"><h3>Programados</h3><p>' + stats.programados + '</p></div><div class="stat-card"><h3>En Curso</h3><p>' + stats.enCurso + '</p></div><div class="stat-card"><h3>Completados</h3><p>' + stats.completados + '</p></div></div><h2>Eventos por Tipo</h2><table><thead><tr><th>Tipo de Evento</th><th>Cantidad</th></tr></thead><tbody>' + typeRows + '</tbody></table><h2>Listado de Eventos</h2><table><thead><tr><th>T칤tulo</th><th>Tipo</th><th>Fecha</th><th>Ubicaci칩n</th><th>Estado</th></tr></thead><tbody>' + eventRows + '</tbody></table><div class="footer"><p>Generado autom치ticamente por SuperVision - Sistema de Monitoreo</p><p>춸 ' + year + ' Todos los derechos reservados</p></div></body></html>';

            // Crear y descargar el reporte
            const blob = new Blob([reportHTML], { type: 'text/html;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `reporte-eventos-${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);

            this.showToast('Reporte generado exitosamente', 'success');
        } catch (error) {
            console.error('Error generating report:', error);
            this.showToast('Error al generar reporte: ' + error.message, 'error');
        }
    },

    // Toast notifications
    showToast(message, type = 'info', duration = 4000) {
        const toast = {
            id: Date.now() + Math.random(),
            message: message,
            type: type,
            show: true
        };
        this.toasts.push(toast);

        setTimeout(() => {
            toast.show = false;
            setTimeout(() => {
                const index = this.toasts.findIndex(t => t.id === toast.id);
                if (index > -1) {
                    this.toasts.splice(index, 1);
                }
            }, 300);
        }, duration);
    },

    removeToast(id) {
        const toast = this.toasts.find(t => t.id === id);
        if (toast) {
            toast.show = false;
            setTimeout(() => {
                const index = this.toasts.findIndex(t => t.id === id);
                if (index > -1) {
                    this.toasts.splice(index, 1);
                }
            }, 300);
        }
    }
            };
        }
    </script>
</head>
<body class="bg-gray-50" x-data="eventosData()">

    <!-- Mobile Overlay -->
    <div x-show="sidebarOpen" 
         @click="sidebarOpen = false"
         x-transition:enter="transition-opacity ease-linear duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition-opacity ease-linear duration-300"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"></div>

    <!-- Sidebar -->
    <aside :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'" 
            class="fixed left-0 top-0 h-full bg-white shadow-xl transition-all duration-300 z-50 w-64 lg:w-64">
        <div class="flex flex-col h-full">
            <div class="p-4 lg:p-6 gradient-bg">
                <div class="flex items-center justify-between">
                    <div class="text-white">
                        <h1 class="text-lg lg:text-xl font-bold">SuperVision</h1>
                        <p class="text-xs text-purple-200">Sistema de Monitoreo</p>
                    </div>
                    <button @click="sidebarOpen = !sidebarOpen" class="text-white hover:bg-white/20 p-2 rounded-lg lg:hidden">
                        <i class="fas fa-times"></i>
                    </button>
                    <button @click="sidebarOpen = !sidebarOpen" class="text-white hover:bg-white/20 p-2 rounded-lg hidden lg:block">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>

            <nav class="flex-1 p-2 lg:p-4 space-y-1 lg:space-y-2 overflow-y-auto">
                <a href="index.html" class="flex items-center space-x-3 p-2 lg:p-3 rounded-xl hover:bg-gray-100 text-gray-700 transition-colors">
                    <i class="fas fa-chart-line w-5 lg:w-6"></i>
                    <span class="font-medium text-sm lg:text-base">Dashboard</span>
                </a>

                <a href="registro-evidencias.html" class="flex items-center space-x-3 p-2 lg:p-3 rounded-xl hover:bg-gray-100 text-gray-700 transition-colors">
                    <i class="fas fa-camera w-5 lg:w-6"></i>
                    <span class="font-medium text-sm lg:text-base">Registro de Evidencias</span>
                </a>

                <a href="listados.html" class="flex items-center space-x-3 p-2 lg:p-3 rounded-xl hover:bg-gray-100 text-gray-700 transition-colors">
                    <i class="fas fa-list-alt w-5 lg:w-6"></i>
                    <span class="font-medium text-sm lg:text-base">Listados y Registros</span>
                </a>

                <a href="supervision-tiempo-real.html" class="flex items-center space-x-3 p-2 lg:p-3 rounded-xl hover:bg-gray-100 text-gray-700 transition-colors">
                    <i class="fas fa-eye w-5 lg:w-6"></i>
                    <span class="font-medium text-sm lg:text-base">Supervisi칩n en Vivo</span>
                </a>

                <a href="eventos-capacitacion.html" class="flex items-center space-x-3 p-2 lg:p-3 rounded-xl bg-gradient-to-r from-purple-500 to-purple-600 text-white">
                    <i class="fas fa-calendar-check w-5 lg:w-6"></i>
                    <span class="font-medium text-sm lg:text-base">Eventos y Capacitaci칩n</span>
                </a>

                <hr class="my-2 lg:my-4">

                <a href="configuracion.html" class="flex items-center space-x-3 p-2 lg:p-3 rounded-xl hover:bg-gray-100 text-gray-700 transition-colors">
                    <i class="fas fa-cog w-5 lg:w-6"></i>
                    <span class="font-medium text-sm lg:text-base">Configuraci칩n</span>
                </a>

                <a href="ayuda.html" class="flex items-center space-x-3 p-2 lg:p-3 rounded-xl hover:bg-gray-100 text-gray-700 transition-colors">
                    <i class="fas fa-question-circle w-5 lg:w-6"></i>
                    <span class="font-medium text-sm lg:text-base">Ayuda</span>
                </a>
            </nav>

            <div class="p-3 lg:p-4 border-t">
                <div class="flex items-center space-x-2 lg:space-x-3 mb-3">
                    <img :src="userProfile ? `https://ui-avatars.com/api/?name=${encodeURIComponent(userProfile.full_name || 'User')}&background=667eea&color=fff` : 'https://ui-avatars.com/api/?name=User&background=667eea&color=fff'"
                         class="w-8 h-8 lg:w-10 lg:h-10 rounded-full flex-shrink-0" alt="User">
                    <div class="min-w-0 flex-1">
                        <p class="text-xs lg:text-sm font-semibold text-gray-700 truncate" x-text="userProfile ? userProfile.full_name : 'Usuario'"></p>
                        <p class="text-[10px] lg:text-xs text-gray-500 truncate" x-text="userProfile ? (userProfile.role || 'Usuario').charAt(0).toUpperCase() + (userProfile.role || 'Usuario').slice(1) : 'Usuario'"></p>
                    </div>
                </div>
                <button @click="api.logout()" class="w-full flex items-center justify-center space-x-2 px-3 lg:px-4 py-2 lg:py-2.5 bg-red-50 hover:bg-red-100 text-red-600 rounded-xl font-medium transition-colors text-sm lg:text-base">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Cerrar Sesi칩n</span>
                </button>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="lg:ml-64 transition-all duration-300">

        <!-- Toast Container -->
        <div class="fixed top-16 lg:top-20 right-2 lg:right-6 z-[9999] space-y-3" style="max-width: calc(100vw - 1rem); width: 100%; max-width: 400px;">
            <template x-for="toast in toasts" :key="toast.id">
                <div x-show="toast.show"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 transform translate-x-full"
                     x-transition:enter-end="opacity-100 transform translate-x-0"
                     x-transition:leave="transition ease-in duration-200"
                     x-transition:leave-start="opacity-100 transform translate-x-0"
                     x-transition:leave-end="opacity-0 transform translate-x-full"
                     class="bg-white rounded-lg shadow-2xl border-l-4 p-3 lg:p-4 flex items-start space-x-2 lg:space-x-3 w-full"
                     :class="{
                         'border-green-500': toast.type === 'success',
                         'border-red-500': toast.type === 'error',
                         'border-yellow-500': toast.type === 'warning',
                         'border-blue-500': toast.type === 'info'
                     }">
                    <div class="flex-shrink-0">
                        <i class="fas text-xl"
                           :class="{
                               'fa-check-circle text-green-500': toast.type === 'success',
                               'fa-exclamation-circle text-red-500': toast.type === 'error',
                               'fa-exclamation-triangle text-yellow-500': toast.type === 'warning',
                               'fa-info-circle text-blue-500': toast.type === 'info'
                           }"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-semibold text-gray-800 break-words whitespace-pre-line" x-text="toast.message"></p>
                    </div>
                    <button @click="removeToast(toast.id)" class="flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                </div>
            </template>
        </div>

        <!-- Top Bar -->
        <header class="bg-white shadow-sm sticky top-0 z-40">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between p-4 lg:p-6 gap-4">
                <div class="flex items-center justify-between w-full lg:w-auto">
                    <div class="flex-1">
                        <div class="flex items-center gap-3">
                            <button @click="sidebarOpen = true" class="lg:hidden text-gray-600 hover:bg-gray-100 p-2 rounded-lg">
                                <i class="fas fa-bars text-xl"></i>
                            </button>
                            <div>
                                <h2 class="text-xl lg:text-2xl font-bold text-gray-800">Eventos y Capacitaci칩n</h2>
                                <p class="text-gray-500 text-xs lg:text-sm hidden sm:block">Gestiona y monitorea eventos de capacitaci칩n y procesos formativos</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center space-x-2 lg:space-x-4 flex-wrap lg:flex-nowrap">
                    <button @click="openEventModal()" class="px-4 lg:px-6 py-2 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl font-medium hover:shadow-lg transition-all text-sm whitespace-nowrap">
                        <i class="fas fa-plus mr-1 lg:mr-2"></i><span class="hidden sm:inline">Nuevo Evento</span><span class="sm:hidden">Nuevo</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="p-4 lg:p-6">

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-6 lg:mb-8">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium mb-1">Total Eventos</p>
                            <p class="text-3xl font-bold text-gray-800" x-text="eventStats.total_events || 0"></p>
                        </div>
                        <div class="p-4 bg-gradient-to-br from-blue-400 to-blue-500 rounded-xl">
                            <i class="fas fa-calendar-alt text-white text-2xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium mb-1">En Curso</p>
                            <p class="text-3xl font-bold text-gray-800" x-text="eventStats.en_curso || 0"></p>
                        </div>
                        <div class="p-4 bg-gradient-to-br from-green-400 to-green-500 rounded-xl">
                            <i class="fas fa-play-circle text-white text-2xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium mb-1">Programados</p>
                            <p class="text-3xl font-bold text-gray-800" x-text="eventStats.programado || 0"></p>
                        </div>
                        <div class="p-4 bg-gradient-to-br from-orange-400 to-orange-500 rounded-xl">
                            <i class="fas fa-clock text-white text-2xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium mb-1">Participantes</p>
                            <p class="text-3xl font-bold text-gray-800" x-text="eventStats.total_participants || 0"></p>
                        </div>
                        <div class="p-4 bg-gradient-to-br from-purple-400 to-purple-500 rounded-xl">
                            <i class="fas fa-users text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6">

                <!-- Events List -->
                <div class="lg:col-span-2 space-y-6">

                    <!-- Filters -->
                    <div class="bg-white rounded-2xl shadow-lg p-4 lg:p-6">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                            <div class="flex flex-wrap gap-2">
                                <button @click="filterStatus = 'all'"
                                        :class="filterStatus === 'all' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                        class="px-3 lg:px-4 py-2 rounded-xl font-medium transition-all text-sm">
                                    Todos
                                </button>
                                <button @click="filterStatus = 'Programado'"
                                        :class="filterStatus === 'Programado' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                        class="px-4 py-2 rounded-xl font-medium transition-all">
                                    Programados
                                </button>
                                <button @click="filterStatus = 'En curso'"
                                        :class="filterStatus === 'En curso' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                        class="px-4 py-2 rounded-xl font-medium transition-all">
                                    En Curso
                                </button>
                                <button @click="filterStatus = 'Completado'"
                                        :class="filterStatus === 'Completado' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                        class="px-4 py-2 rounded-xl font-medium transition-all">
                                    Completados
                                </button>
                            </div>

                            <div class="flex items-center space-x-2">
                                <button @click="viewMode = 'grid'"
                                        :class="viewMode === 'grid' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700'"
                                        class="p-2 rounded-lg transition-all">
                                    <i class="fas fa-th-large"></i>
                                </button>
                                <button @click="viewMode = 'list'"
                                        :class="viewMode === 'list' ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700'"
                                        class="p-2 rounded-lg transition-all">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div x-show="loading" class="text-center py-16">
                        <i class="fas fa-spinner fa-spin text-purple-600 text-4xl mb-4"></i>
                        <p class="text-gray-600 font-semibold mb-2">Cargando eventos...</p>
                    </div>
                    <!-- Events Grid/List -->
                    <div x-show="viewMode === 'grid' && !loading" class="grid grid-cols-1 sm:grid-cols-2 gap-4 lg:gap-6">
                        <template x-for="event in filteredEvents" :key="event.id">
                            <div class="event-card bg-white rounded-2xl shadow-lg overflow-hidden cursor-pointer"
                                 @click="openEventModal(event)">
                                <!-- Header -->
                                <div class="p-6 bg-gradient-to-br"
                                     :class="{
                                         'from-blue-500 to-blue-600': event.color === 'blue',
                                         'from-purple-500 to-purple-600': event.color === 'purple',
                                         'from-green-500 to-green-600': event.color === 'green',
                                         'from-orange-500 to-orange-600': event.color === 'orange',
                                         'from-indigo-500 to-indigo-600': event.color === 'indigo',
                                         'from-pink-500 to-pink-600': event.color === 'pink'
                                     }">
                                    <div class="flex items-start justify-between mb-4">
                                        <span class="px-3 py-1 bg-white/20 backdrop-blur-sm text-white rounded-lg text-xs font-semibold" x-text="event.type || 'Evento'"></span>
                                        <span class="px-3 py-1 bg-white/20 backdrop-blur-sm text-white rounded-lg text-xs font-semibold" x-text="mapStatus(event.status)"></span>
                                    </div>
                                    <h3 class="text-xl font-bold text-white mb-2" x-text="event.title"></h3>
                                    <p class="text-white/90 text-sm" x-text="event.description || 'Sin descripci칩n'"></p>
                                </div>

                                <!-- Content -->
                                <div class="p-6 space-y-3">
                                    <!-- Indicador de reuni칩n en l칤nea -->
                                    <div x-show="event.meeting_url" class="flex items-center space-x-2 p-3 bg-blue-50 rounded-lg border border-blue-200">
                                        <i class="fas fa-video text-blue-600"></i>
                                        <div class="flex-1">
                                            <p class="text-xs font-semibold text-blue-800" x-text="getPlatformName(event.meeting_url) || 'Reuni칩n en l칤nea'"></p>
                                            <p class="text-xs text-blue-600">Enlace de reuni칩n disponible</p>
                                        </div>
                                        <button @click.stop="openMeetingUrl(event)" 
                                                class="px-3 py-1 bg-blue-600 text-white rounded-lg text-xs font-semibold hover:bg-blue-700 transition-colors">
                                            <i class="fas fa-external-link-alt mr-1"></i>
                                            Abrir
                                        </button>
                                    </div>
                                    
                                    <div class="flex items-center text-gray-600 text-sm">
                                        <i class="fas fa-calendar w-5 text-purple-600"></i>
                                        <span x-text="formatDate(event.start_date)"></span>
                                    </div>
                                    <div class="flex items-center text-gray-600 text-sm">
                                        <i class="fas fa-clock w-5 text-purple-600"></i>
                                        <span x-text="`${formatTime(event.start_time)} - ${formatTime(event.end_time)}`"></span>
                                    </div>
                                    <div class="flex items-center text-gray-600 text-sm">
                                        <i class="fas fa-map-marker-alt w-5 text-purple-600"></i>
                                        <span x-text="event.location || 'Sin ubicaci칩n'"></span>
                                    </div>

                                    <!-- Progress Bar -->
                                    <div class="pt-3">
                                        <div class="flex items-center justify-between text-sm mb-2">
                                            <span class="text-gray-600">Participantes</span>
                                            <span class="font-semibold text-gray-800">
                                                <span x-text="event.current_participants || 0"></span>/<span x-text="event.max_participants || 0"></span>
                                            </span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-purple-600 h-2 rounded-full transition-all"
                                                 :style="`width: ${Math.min(((event.current_participants || 0) / (event.max_participants || 1)) * 100, 100)}%`"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Footer -->
                                <div class="px-6 pb-6 flex items-center justify-between">
                                    <button @click.stop="openEventModal(event)" class="text-purple-600 hover:text-purple-700 font-medium text-sm">
                                        Ver detalles <i class="fas fa-arrow-right ml-1"></i>
                                    </button>
                                    <div class="flex items-center space-x-2">
                                        <button @click.stop="openEventModal(event)" class="p-2 hover:bg-purple-50 text-purple-600 rounded-lg transition-colors">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button @click.stop="deleteEvent(event.id)" class="p-2 hover:bg-red-50 text-red-600 rounded-lg transition-colors">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>
                        <div x-show="filteredEvents.length === 0" class="col-span-2 text-center py-16">
                            <i class="fas fa-calendar-times text-gray-300 text-6xl mb-4"></i>
                            <p class="text-gray-600 font-semibold mb-2">No hay eventos</p>
                            <p class="text-sm text-gray-500">Crea tu primer evento para comenzar</p>
                        </div>
                    </div>

                    <!-- List View -->
                    <div x-show="viewMode === 'list' && !loading" class="bg-white rounded-2xl shadow-lg overflow-hidden">
                        <template x-for="event in filteredEvents" :key="event.id">
                            <div class="p-6 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer"
                                 @click="openEventModal(event)">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-3 mb-2">
                                            <h3 class="text-lg font-bold text-gray-800" x-text="event.title"></h3>
                                            <span class="px-3 py-1 rounded-full text-xs font-semibold"
                                                  :class="{
                                                      'bg-green-100 text-green-700': event.status === 'en_curso' || event.status === 'En curso',
                                                      'bg-blue-100 text-blue-700': event.status === 'programado' || event.status === 'Programado',
                                                      'bg-gray-100 text-gray-700': event.status === 'completado' || event.status === 'Completado'
                                                  }"
                                                  x-text="mapStatus(event.status)"></span>
                                        </div>
                                        <p class="text-sm text-gray-600 mb-3" x-text="event.description || 'Sin descripci칩n'"></p>
                                        <div class="flex flex-wrap gap-4 text-sm text-gray-600 mb-2">
                                            <span><i class="fas fa-calendar text-purple-600 mr-1"></i><span x-text="formatDate(event.start_date)"></span></span>
                                            <span><i class="fas fa-clock text-purple-600 mr-1"></i><span x-text="`${formatTime(event.start_time)} - ${formatTime(event.end_time)}`"></span></span>
                                            <span><i class="fas fa-map-marker-alt text-purple-600 mr-1"></i><span x-text="event.location || 'Sin ubicaci칩n'"></span></span>
                                        </div>
                                        <!-- Indicador de reuni칩n en l칤nea en vista de lista -->
                                        <div x-show="event.meeting_url" class="flex items-center space-x-2 mt-2 p-2 bg-blue-50 rounded-lg">
                                            <i class="fas fa-video text-blue-600 text-xs"></i>
                                            <span class="text-xs text-blue-600 font-medium" x-text="getPlatformName(event.meeting_url) || 'Reuni칩n en l칤nea'"></span>
                                            <button @click.stop="openMeetingUrl(event)" 
                                                    class="ml-auto px-2 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700 transition-colors">
                                                <i class="fas fa-external-link-alt mr-1"></i>
                                                Abrir
                                            </button>
                                        </div>
                                    </div>
                                    <div class="ml-6 text-right">
                                        <div class="text-2xl font-bold text-purple-600 mb-1">
                                            <span x-text="event.current_participants || 0"></span>/<span x-text="event.max_participants || 0"></span>
                                        </div>
                                        <p class="text-xs text-gray-500">Participantes</p>
                                    </div>
                                </div>
                            </div>
                        </template>
                        <div x-show="filteredEvents.length === 0" class="text-center py-16">
                            <i class="fas fa-calendar-times text-gray-300 text-6xl mb-4"></i>
                            <p class="text-gray-600 font-semibold mb-2">No hay eventos</p>
                            <p class="text-sm text-gray-500">Crea tu primer evento para comenzar</p>
                        </div>
                    </div>

                </div>

                <!-- Sidebar -->
                <div class="space-y-6">

                    <!-- Mini Calendar -->
                    <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6">
                        <h3 class="text-base sm:text-lg font-bold text-gray-800 mb-3 sm:mb-4 flex items-center justify-between">
                            <span class="flex items-center">
                                <i class="fas fa-calendar-alt text-purple-600 mr-2 text-sm sm:text-base"></i>
                                <span class="text-sm sm:text-base" x-text="getCalendarMonthName()"></span>
                            </span>
                            <div class="flex items-center space-x-1 sm:space-x-2">
                                <button @click="previousMonth()" class="p-1 sm:p-1.5 hover:bg-gray-100 rounded transition-colors">
                                    <i class="fas fa-chevron-left text-xs sm:text-sm"></i>
                                </button>
                                <button @click="goToToday()" class="px-2 py-1 text-xs sm:text-sm text-purple-600 hover:bg-purple-50 rounded transition-colors font-medium" title="Ir a hoy">
                                    Hoy
                                </button>
                                <button @click="nextMonth()" class="p-1 sm:p-1.5 hover:bg-gray-100 rounded transition-colors">
                                    <i class="fas fa-chevron-right text-xs sm:text-sm"></i>
                                </button>
                            </div>
                        </h3>

                        <div class="calendar-grid text-center text-[10px] sm:text-xs mb-2">
                            <div class="font-semibold text-gray-600">Dom</div>
                            <div class="font-semibold text-gray-600">Lun</div>
                            <div class="font-semibold text-gray-600">Mar</div>
                            <div class="font-semibold text-gray-600">Mi칠</div>
                            <div class="font-semibold text-gray-600">Jue</div>
                            <div class="font-semibold text-gray-600">Vie</div>
                            <div class="font-semibold text-gray-600">S치b</div>
                        </div>

                        <div class="calendar-grid text-xs sm:text-sm">
                            <template x-for="(dayObj, index) in getCalendarDays()" :key="index">
                                <template x-if="dayObj.day !== null">
                                    <div 
                                        class="calendar-day text-gray-700 font-medium cursor-pointer"
                                        :class="{
                                            'has-event bg-purple-50 text-purple-700': hasEventOnDate(dayObj.date),
                                            'bg-blue-50 text-blue-700 font-bold border-2 border-blue-300': isToday(dayObj.date)
                                        }"
                                        @click="selectDay(dayObj.date)"
                                        x-text="dayObj.day"></div>
                                </template>
                                <template x-if="dayObj.day === null">
                                    <div class="calendar-day"></div>
                                </template>
                            </template>
                        </div>
                    </div>

                    <!-- Upcoming Events -->
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-bell text-orange-600 mr-2"></i>Pr칩ximos Eventos
                        </h3>

                        <div class="space-y-3">
                            <template x-for="event in events.filter(e => e.status === 'programado' || e.status === 'Programado').slice(0, 3)" :key="event.id">
                                <div class="p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors cursor-pointer" @click="openEventModal(event)">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0"
                                             :class="`bg-${event.color}-100`">
                                            <i class="fas fa-calendar-day text-xl"
                                               :class="`text-${event.color}-600`"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="text-sm font-semibold text-gray-800 truncate" x-text="event.title"></p>
                                            <p class="text-xs text-gray-500" x-text="formatDate(event.start_date) + '  ' + formatTime(event.start_time)"></p>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <div x-show="events.filter(e => e.status === 'programado' || e.status === 'Programado').length === 0" class="text-center py-4">
                                <i class="fas fa-inbox text-gray-300 text-2xl mb-2"></i>
                                <p class="text-xs text-gray-500">No hay eventos programados</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl shadow-lg p-6 text-white">
                        <h3 class="text-lg font-bold mb-4">
                            <i class="fas fa-bolt mr-2"></i>Acciones R치pidas
                        </h3>

                        <div class="space-y-3">
                            <button @click="exportCalendar()" class="w-full p-3 bg-white/20 hover:bg-white/30 rounded-xl transition-all text-left flex items-center">
                                <i class="fas fa-file-export mr-3"></i>
                                <span class="font-medium">Exportar calendario</span>
                            </button>
                            <button @click="viewParticipants()" class="w-full p-3 bg-white/20 hover:bg-white/30 rounded-xl transition-all text-left flex items-center">
                                <i class="fas fa-users mr-3"></i>
                                <span class="font-medium">Ver participantes</span>
                            </button>
                            <button @click="generateReport()" class="w-full p-3 bg-white/20 hover:bg-white/30 rounded-xl transition-all text-left flex items-center">
                                <i class="fas fa-chart-bar mr-3"></i>
                                <span class="font-medium">Generar reporte</span>
                            </button>
                        </div>
                    </div>

                </div>

            </div>

        </main>

    </div>

    <!-- Event Modal -->
    <div x-show="showEventModal"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black/50 modal-backdrop flex items-center justify-center z-50 p-4"
         @click.self="showEventModal = false">

        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform scale-90"
             x-transition:enter-end="opacity-100 transform scale-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 transform scale-100"
             x-transition:leave-end="opacity-0 transform scale-90">

            <div class="sticky top-0 bg-gradient-to-r from-purple-500 to-purple-600 p-4 lg:p-8 text-white">
                <div class="flex items-start justify-between gap-4">
                    <div class="flex-1 min-w-0">
                        <h2 class="text-xl lg:text-2xl font-bold mb-2" x-text="selectedEvent ? selectedEvent.title : 'Nuevo Evento'"></h2>
                        <p class="text-purple-100 text-sm lg:text-base line-clamp-2" x-text="selectedEvent ? selectedEvent.description : 'Crea un nuevo evento de capacitaci칩n'"></p>
                    </div>
                    <button @click="showEventModal = false" class="text-white hover:bg-white/20 p-2 rounded-lg transition-colors flex-shrink-0">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <div class="p-4 lg:p-8 space-y-4 lg:space-y-6">
                <!-- Create/Edit Event Form -->
                <form @submit.prevent="saveEvent()" class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">T칤tulo del Evento</label>
                            <input type="text" x-model="formData.title" placeholder="Ej: Capacitaci칩n Tecnol칩gica" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Descripci칩n</label>
                            <textarea rows="3" x-model="formData.description" placeholder="Describe el evento..."
                                      class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none"></textarea>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Tipo</label>
                                <select x-model="formData.type" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm">
                                    <option value="capacitacion">Capacitaci칩n</option>
                                    <option value="workshop">Workshop</option>
                                    <option value="seminario">Seminario</option>
                                    <option value="taller">Taller</option>
                                    <option value="conferencia">Conferencia</option>
                                    <option value="webinar">Webinar</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Fecha Inicio</label>
                                <input type="date" x-model="formData.start_date" required
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Hora Inicio</label>
                                <input type="time" x-model="formData.start_time" required
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Hora Fin</label>
                                <input type="time" x-model="formData.end_time" required
                                       class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ubicaci칩n</label>
                            <input type="text" x-model="formData.location" placeholder="Ej: Sala Principal" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Capacidad M치xima</label>
                            <input type="number" x-model="formData.max_participants" placeholder="50" min="1" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="fas fa-video text-blue-600 mr-2"></i>
                                Enlace de Reuni칩n (Opcional)
                            </label>
                            <input type="url" x-model="formData.meeting_url" 
                                   placeholder="https://meet.google.com/xxx o https://meet.jit.si/xxx"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <p class="text-xs text-gray-500 mt-1">
                                <i class="fas fa-info-circle mr-1"></i>
                                Soporta: Google Meet, Jitsi Meet, Zoom, Microsoft Teams, Webex, etc.
                            </p>
                            <div x-show="formData.meeting_url && getPlatformName(formData.meeting_url)" 
                                 class="mt-2 p-2 bg-blue-50 rounded-lg border border-blue-200">
                                <p class="text-xs text-blue-800">
                                    <i class="fas fa-check-circle mr-1"></i>
                                    Plataforma detectada: <span class="font-semibold" x-text="getPlatformName(formData.meeting_url)"></span>
                                </p>
                            </div>
                        </div>

                        <!-- Event Actions (only for existing events) -->
                        <div x-show="selectedEvent" class="pt-4 border-t border-gray-200 mb-4">
                            <button type="button" @click="showEventModal = false; viewParticipants(selectedEvent.id)" 
                                    class="w-full py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors text-sm">
                                <i class="fas fa-users mr-2"></i>
                                Ver Participantes
                            </button>
                        </div>

                        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 pt-4">
                            <button type="submit" :disabled="saving"
                                    :class="saving ? 'opacity-50 cursor-not-allowed' : ''"
                                    class="flex-1 py-3 bg-purple-600 text-white rounded-xl font-medium hover:bg-purple-700 transition-colors text-sm">
                                <i :class="saving ? 'fas fa-spinner fa-spin' : 'fas fa-save'" class="mr-2"></i>
                                <span x-text="selectedEvent ? 'Actualizar Evento' : 'Crear Evento'"></span>
                            </button>
                            <button type="button" @click="showEventModal = false" :disabled="saving"
                                    class="flex-1 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors text-sm">
                                Cancelar
                            </button>
                            <button x-show="selectedEvent" type="button" @click="deleteEvent(selectedEvent.id)" :disabled="saving"
                                    class="px-4 py-3 bg-red-600 text-white rounded-xl font-medium hover:bg-red-700 transition-colors text-sm sm:w-auto w-full">
                                <i class="fas fa-trash mr-2"></i><span class="sm:hidden">Eliminar</span>
                            </button>
                        </div>
                    </form>
            </div>

        </div>
    </div>

    <!-- Participants Modal -->
    <div x-show="showParticipantsModal"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black/50 modal-backdrop z-[9999] flex items-center justify-center p-4"
         @click.self="showParticipantsModal = false">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-4 lg:p-6 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-t-2xl">
                <div class="flex items-center justify-between gap-4">
                    <div class="flex-1 min-w-0">
                        <h3 class="text-xl lg:text-2xl font-bold" x-text="selectedEventForParticipants ? 'Participantes del Evento' : 'Participantes Registrados'"></h3>
                        <p class="text-purple-100 text-sm mt-1" x-show="selectedEventForParticipants">
                            <span x-text="selectedEventForParticipants?.title || ''"></span> - 
                            Total: <span x-text="participants.length"></span> participantes
                        </p>
                        <p class="text-purple-100 text-sm mt-1" x-show="!selectedEventForParticipants">
                            Total: <span x-text="participants.length"></span> participantes
                        </p>
                    </div>
                    <button @click="showParticipantsModal = false" class="text-white hover:bg-white/20 p-2 rounded-lg transition-colors flex-shrink-0">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <div class="p-4 lg:p-8">
                <!-- Add Participant Buttons (only for specific event) -->
                <div x-show="selectedEventForParticipants" class="mb-6 space-y-3">
                    <!-- Bot칩n para due침o: Agregar Participantes -->
                    <button x-show="isEventOwner(selectedEventForParticipants)" 
                            @click="openAddParticipantModal(selectedEventForParticipants.id)" 
                            class="w-full py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors">
                        <i class="fas fa-user-plus mr-2"></i>
                        Agregar Participantes
                    </button>
                    <!-- Bot칩n para no due침o: Registrarse -->
                    <button x-show="!isEventOwner(selectedEventForParticipants)" 
                            @click="addParticipantToEvent(selectedEventForParticipants.id)" 
                            class="w-full py-3 bg-green-600 text-white rounded-xl font-medium hover:bg-green-700 transition-colors">
                        <i class="fas fa-user-plus mr-2"></i>
                        Registrarme en este Evento
                    </button>
                </div>

                <div x-show="participants.length === 0" class="text-center py-12">
                    <i class="fas fa-users text-6xl text-gray-300 mb-4"></i>
                    <p class="text-xl font-semibold text-gray-600 mb-2">No hay participantes registrados</p>
                    <p class="text-sm text-gray-500" x-text="selectedEventForParticipants ? 'S칠 el primero en registrarte en este evento' : 'Los participantes aparecer치n aqu칤 cuando se registren en eventos'"></p>
                </div>

                <div x-show="participants.length > 0" class="overflow-x-auto -mx-4 lg:mx-0">
                    <table class="w-full min-w-[600px]">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 lg:px-6 py-3 lg:py-4 text-left text-xs lg:text-sm font-semibold text-gray-600">Participante</th>
                                <th class="px-4 lg:px-6 py-3 lg:py-4 text-left text-xs lg:text-sm font-semibold text-gray-600">Email</th>
                                <th class="px-4 lg:px-6 py-3 lg:py-4 text-left text-xs lg:text-sm font-semibold text-gray-600" x-show="!selectedEventForParticipants">Eventos Inscritos</th>
                                <th class="px-4 lg:px-6 py-3 lg:py-4 text-left text-xs lg:text-sm font-semibold text-gray-600" x-show="selectedEventForParticipants">Estado</th>
                                <th class="px-4 lg:px-6 py-3 lg:py-4 text-left text-xs lg:text-sm font-semibold text-gray-600" x-show="!selectedEventForParticipants">Acciones</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <template x-for="participant in participants" :key="participant.id">
                                <tr class="hover:bg-gray-50 transition-colors">
                                    <td class="px-4 lg:px-6 py-3 lg:py-4">
                                        <div class="flex items-center space-x-2 lg:space-x-3">
                                            <div class="w-8 h-8 lg:w-10 lg:h-10 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0">
                                                <i class="fas fa-user text-purple-600 text-xs lg:text-sm"></i>
                                            </div>
                                            <div class="min-w-0">
                                                <p class="font-semibold text-gray-800 text-sm lg:text-base truncate" x-text="participant.name"></p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-4 lg:px-6 py-3 lg:py-4 text-xs lg:text-sm text-gray-600 truncate max-w-[150px] lg:max-w-none" x-text="participant.email"></td>
                                    <td class="px-4 lg:px-6 py-3 lg:py-4" x-show="!selectedEventForParticipants">
                                        <span class="px-2 lg:px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs lg:text-sm font-medium" x-text="participant.eventsCount + ' evento(s)'"></span>
                                    </td>
                                    <td class="px-4 lg:px-6 py-3 lg:py-4" x-show="selectedEventForParticipants">
                                        <span class="px-2 lg:px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs lg:text-sm font-medium" x-text="participant.attendance_status === 'registered' ? 'Registrado' : participant.attendance_status || 'Registrado'"></span>
                                    </td>
                                    <td class="px-4 lg:px-6 py-3 lg:py-4" x-show="!selectedEventForParticipants">
                                        <button @click="alert('Eventos: ' + participant.events.join(', '))"
                                                class="text-purple-600 hover:text-purple-700 font-medium text-xs lg:text-sm">
                                            <i class="fas fa-info-circle mr-1"></i><span class="hidden sm:inline">Ver detalles</span><span class="sm:hidden">Detalles</span>
                                        </button>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>

                <div class="flex items-center justify-end pt-6 border-t border-gray-200 mt-6">
                    <button @click="showParticipantsModal = false"
                            class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Participant Modal -->
    <div x-show="showAddParticipantModal"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black/50 modal-backdrop z-[9999] flex items-center justify-center p-4"
         @click.self="showAddParticipantModal = false">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-4 lg:p-6 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-t-2xl">
                <div class="flex items-center justify-between gap-4">
                    <div class="flex-1 min-w-0">
                        <h3 class="text-xl lg:text-2xl font-bold">Agregar Participantes</h3>
                        <p class="text-blue-100 text-sm mt-1" x-text="selectedEventForParticipants ? 'Evento: ' + selectedEventForParticipants.title : ''"></p>
                    </div>
                    <button @click="showAddParticipantModal = false" class="text-white hover:bg-white/20 p-2 rounded-lg transition-colors flex-shrink-0">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <div class="p-4 lg:p-8">
                <!-- Search Bar -->
                <div class="mb-6">
                    <div class="relative">
                        <input type="text" 
                               x-model="searchUserQuery"
                               placeholder="Buscar por nombre o email..."
                               class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                </div>

                <!-- Users List -->
                <div class="space-y-2 max-h-96 overflow-y-auto">
                    <template x-for="user in filteredAvailableUsers" :key="user.id">
                        <div class="flex items-center justify-between p-4 border border-gray-200 rounded-xl hover:border-blue-300 hover:bg-blue-50 transition-colors">
                            <div class="flex items-center space-x-3 flex-1 min-w-0">
                                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-user text-blue-600"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="font-semibold text-gray-800 truncate" x-text="user.full_name || 'Usuario'"></p>
                                    <p class="text-sm text-gray-500 truncate" x-text="user.email"></p>
                                    <p class="text-xs text-gray-400 mt-1" x-text="'Rol: ' + (user.role || 'viewer')"></p>
                                </div>
                            </div>
                            <button @click="addParticipantToEvent(selectedEventForParticipants.id, user.id)"
                                    class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm whitespace-nowrap">
                                <i class="fas fa-plus mr-1"></i>
                                Agregar
                            </button>
                        </div>
                    </template>
                    
                    <div x-show="filteredAvailableUsers.length === 0" class="text-center py-12">
                        <i class="fas fa-users text-6xl text-gray-300 mb-4"></i>
                        <p class="text-xl font-semibold text-gray-600 mb-2">No hay usuarios disponibles</p>
                        <p class="text-sm text-gray-500" x-text="searchUserQuery ? 'No se encontraron usuarios con ese criterio' : 'Todos los usuarios ya est치n registrados en este evento'"></p>
                    </div>
                </div>

                <div class="flex items-center justify-end pt-6 border-t border-gray-200 mt-6">
                    <button @click="showAddParticipantModal = false"
                            class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="fixed top-20 right-6 z-[9999] space-y-3" style="max-width: 400px;">
        <template x-for="toast in toasts" :key="toast.id">
            <div x-show="toast.show"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-x-full"
                 x-transition:enter-end="opacity-100 transform translate-x-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 transform translate-x-0"
                 x-transition:leave-end="opacity-0 transform translate-x-full"
                 class="bg-white rounded-lg shadow-2xl border-l-4 p-4 flex items-start space-x-3 min-w-[320px]"
                 :class="{
                     'border-green-500': toast.type === 'success',
                     'border-red-500': toast.type === 'error',
                     'border-yellow-500': toast.type === 'warning',
                     'border-blue-500': toast.type === 'info'
                 }">
                <div class="flex-shrink-0">
                    <i class="fas text-xl"
                       :class="{
                           'fa-check-circle text-green-500': toast.type === 'success',
                           'fa-exclamation-circle text-red-500': toast.type === 'error',
                           'fa-exclamation-triangle text-yellow-500': toast.type === 'warning',
                           'fa-info-circle text-blue-500': toast.type === 'info'
                       }"></i>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-semibold text-gray-800 break-words" x-text="toast.message"></p>
                </div>
                <button @click="removeToast(toast.id)" class="flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times text-sm"></i>
                </button>
            </div>
        </template>
    </div>

</body>
</html>
